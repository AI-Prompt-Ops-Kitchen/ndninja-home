# 2026-02-02 Session Notes

## ğŸ¬ Critical Pipeline Discovery

### TWO Different Pipelines Exist!
- **`ninja-pipeline.sh`** â†’ Uses **Ditto** (face/lip sync ONLY, no body animation)
- **`ninja_content.py`** â†’ Uses **Kling Avatar v2** via fal.ai (FULL body animation, hands move!)

**User's previous videos used `ninja_content.py` with Kling Avatar â€” that's why hands were animated!**
Today I mistakenly used `ninja-pipeline.sh` which only does face animation via Ditto.

### Kling Avatar vs Kling 2.6
- **Kling Avatar v2** = Talking head model (image + audio â†’ lip-synced video with body animation) âœ… WHAT WE NEED
- **Kling 2.5/2.6** = General image-to-video, no audio sync, not avatar-specific

## ğŸ”§ Fixes Applied

### Caption Script Updated
- `ninja_captions.py` now uses **Whisper API with word-level timestamps**
- Previously used estimated timing based on word count (caused sync issues)
- Extracts audio from video â†’ Whisper transcription â†’ accurate word timestamps

### TTS Pause Issues
ElevenLabs adds pauses at:
- Colons (e.g., "Magic: The Gathering")
- Paragraph breaks before continuation sentences
- Quoted text (causes weird inflection)
- ALL CAPS words

**Fixes:**
- Remove colons, use natural flow
- Merge paragraph breaks where sentences continue
- Remove quotes around dialogue
- Use lowercase for emphasis words

### Script Example Fix
```
# BAD (causes pauses):
But here's the part that's really wild,

Every other TCG...

# GOOD (flows smoothly):
But here's what's really wild. Every other TCG...
```

## ğŸš§ In Progress
- Running MTG video through `ninja_content.py` with Kling Avatar v2
- Using revised script with TTS fixes
- Command: `python3 scripts/ninja_content.py --script-file /tmp/ninja_mtg_script_v5.txt --image ~/clawd/assets/ninja_avatar.jpg --output ninja_mtg_drama_v5 --kling-model standard`

## ğŸ“ Keyring Note
- The script can hang if keyring needs GUI/D-Bus session
- Workaround: Set `FAL_KEY` environment variable directly before running
- Key is stored in keyring under `fal_ai` / `api_key`

## ğŸ¯ User Preferences Confirmed
- Check with user BEFORE generating new videos (don't burn through renders)
- User was stressed about pipeline seeming "broken" â€” reassurance matters
- User noticed: hand animation missing, audio getting quieter at end, TTS pauses
